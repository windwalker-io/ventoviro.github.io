<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <link rel="shortcut icon" href="../../../assets/images/logo-icon.png?453c762c52a43b2e08b09781" />

    <title>Basic Usage | Windwalker - PHP Rapid Development Framework</title>

    <meta property="og:image" content="https://i.imgur.com/1HHxwsI.jpg">

        
        <link href="https://unpkg.com/prism-material-themes@1.0.4/themes/material-default.css" rel="stylesheet" />
    <link href="../../../assets/css/bootstrap.css?453c762c52a43b2e08b09781" rel="stylesheet" />
        <link href="../../../assets/css/main.css?453c762c52a43b2e08b09781" rel="stylesheet">

    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MYMEG7N4RV"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-MYMEG7N4RV');
    </script>
</head>
<body class="view-documentation-components-di layout-basic-usage route-documentation-components-di-basic-usage" style="margin-top: 56px">

    <header class="l-main-header">
        <nav class="l-main-nav navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
            <div class="container">
                <a class="navbar-brand" href="../../../">
                    <img src="../../../assets/images/logo-cw-h.svg?453c762c52a43b2e08b09781"
                        alt="LOGO"
                        style="height: 25px;"
                    />
                </a>
                <button class="navbar-toggler" type="button"
                    data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">

                    </ul>

                    <ul class="navbar-nav mb-2 mb-lg-0">
                                                                                                                                                                        <li class="nav-item">
                            <a class="nav-link active"
                                href="../../../documentation">
                                <i class="fa-solid fa-file-lines"></i>
                                Documentation
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active"
                                href="../../../status.html">
                                <i class="fa-solid fa-signal"></i>
                                Status
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active"
                                target="_blank"
                                href="https://github.com/windwalker-io/framework">
                                <i class="fa-brands fa-github"></i>
                                Github
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <div class="text-bg-success py-4" part="">
    <div class="container">
        <div class="gap-2">
            <div class="mb-1  fw-bold"
                style="margin-top: -0.5rem;">
                <a
                    class="link-light"
                    style="text-decoration: none; opacity: .85; "
                >
                    
                </a>
            </div>
            <h2 class="m-0 text-uppercase fw-bold">
                        DI

              
            </h2>
                             
            <div class="breadcrumb m-0">
    <a class="breadcrumb-item link-primary small"
        href="../../../documentation/"
        style="text-decoration: none">
        Documentation
    </a>

            <a class="breadcrumb-item link-primary small"
            href="../../../documentation/components.html"
            style="text-decoration: none">
            Components
        </a>
    
            <a class="breadcrumb-item link-primary small"
            style="text-decoration: none">
            DI
        </a>
    </div>
         
                    </div>
    </div>
</div>

    <div class="l-documentation container my-5">
        <div class="row">
            <div class="l-documentation__menu col-lg-3 mb-5 mb-lg-0">
                <div class="sticky-top" style="top: 65px">
                    <h5 class="fw-bold">
                        Menu: DI
                    </h5>

                    <ul class="nav flex-column">
                                                                                    <li class="nav-item">
    <a href="../../../documentation/components/di/index.html"
        class="nav-link ps-0 ">
        Introduction
    </a>
</li>
                                                                                                                <li class="nav-item">
    <a href="../../../documentation/components/di/basic-usage.html"
        class="nav-link ps-0 active text-success fw-bold">
        Basic Usage
    </a>
</li>
                                                                                                                <li class="nav-item">
    <a href="../../../documentation/components/di/attributes.html"
        class="nav-link ps-0 ">
        Attributes
    </a>
</li>
                                                                                                                <li class="nav-item">
    <a href="../../../documentation/components/di/parameters.html"
        class="nav-link ps-0 ">
        Parameters
    </a>
</li>
                                                                                                                <li class="nav-item">
    <a href="../../../documentation/components/di/multi-levels.html"
        class="nav-link ps-0 ">
        Multi Levels
    </a>
</li>
                                                                        </ul>
                </div>
            </div>

            <div class="l-documentation__body col-lg-7 mb-5 mb-lg-0">
                <article class="article-content" data-content
                    data-bs-spy="scroll"
                    data-bs-target="#toc"
                    data-bs-root-margin="0px 0px -100px"
                    data-bs-smooth-scroll="true"
                >
                    <h1>Basic Usage</h1>
<h2>Create A Container</h2>
<p>Just new an instance.</p>
<pre><code class="language-php">use Windwalker\DI\Container;

$container = new Container();</code></pre>
<p>Now we can store objects into it.</p>
<pre><code class="language-php">use Windwalker\DI\Container;

$input = new Input();

$container-&gt;set('input', $input);

$input = $container-&gt;get('input');</code></pre>
<h2>Lazy Loading</h2>
<p>Sometimes we will hope not to create object instantly, we can use callback to create object.</p>
<pre><code class="language-php">// Set a closure into it
$container-&gt;set('input', fn (Container $container) =&gt; new Input());

// Will call this closure when we get it
$input = $container-&gt;get('input');

// Always get new object.
$input !== $container-&gt;get('input');</code></pre>
<h2>Shared Object (Singleton)</h2>
<p>If we use <code>set()</code> method to set this callback, then every time we try to get it, Container will return a new object.</p>
<p>Use <code>share('foo', $object)</code> to make an object singleton, we'll always get the same instance.</p>
<pre><code class="language-php">use Windwalker\DI\Container;

// Share a closure
$container-&gt;share('input', fn (Container $container) =&gt; new Input());

// Which is same as:
$container-&gt;set('input', fn (Container $container) =&gt; new Input(), Container::SHARED);

// We will always get same instance
$input = $container-&gt;get('input');

// The second argument of get() can force create new instance
$newInput = $container-&gt;get('input', true);</code></pre>
<h2>Protect Object</h2>
<p>Use <code>protect()</code> to prevent others override your important object.</p>
<pre><code class="language-php">$container-&gt;protect(
    'input',
    fn (Container $container) =&gt; new Input(),
    Container::SHARED
);

// We can still get this object
$input = $container-&gt;get('input');

// Trying to override this key, will throw OutOfBoundsException
$container-&gt;set('input', $otherInput);</code></pre>
<h2>Alias</h2>
<pre><code class="language-php">$container-&gt;share('system.application', $app)
    -&gt;alias('app', 'system.application');

// Same as system.application
$app = $container-&gt;get('app');</code></pre>
<h2>Creating Objects</h2>
<h3>New Instance</h3>
<p>Container can help us create object and automatic inject required arguments to constructor.</p>
<pre><code class="language-php">use Windwalker\IO\Input;
use Windwalker\Structure\Structure;

// Prepare dependencies into container
$container-&gt;share(Input::class, $input);
$container-&gt;share(Collection::class, $config);

// Define a class
class MyClass
{
    public function __construct(public Input $input, public Collection $config)
    {
    }
}

// And create it.
$myObject = $container-&gt;newInstance(MyClass::class);

// Now dependencies will be automatic injected
$myObject-&gt;input; // Input
$myObject-&gt;config; // Collection</code></pre>
<h3>Autowire</h3>
<p>If you try to create an object with dependencies which is not set in container, container will throw exception.</p>
<pre><code class="language-php">class MyCar
{
    public function __construct(public Wheel $wheel, public Light $light)
    {
    }
}

// @throw DefinitionResolveException
$container-&gt;newInstance(MyCar::class);</code></pre>
<p>You can add autowire flag to options, the dependency object will auto create and inject it.</p>
<pre><code class="language-php">$car = $container-&gt;newInstance(MyCar::class, [], Container::AUTO_WIRE);</code></pre>
<h3>Create Object</h3>
<p>Create object will new an instance instantly and set this class into container, we can get new instance everytime
when we get it by class name.</p>
<pre><code class="language-php">$sakura = $container-&gt;createObject(Sakura::class);

// Now we can get this class with new instance from container
$sakura !== $container-&gt;get(Sakura::class);</code></pre>
<p>Use <code>createSharedObject()</code> to set object as singleton.</p>
<pre><code class="language-php">// Now this object is singleton 
$katana = $container-&gt;createSharedObject(Katana::class);

$katana === $container-&gt;get(Katana::class); // Same</code></pre>
<h3>Create with Custom Arguments</h3>
<p>If we have some constructor arguments without class hint, container will send the default value to constructor.
We can override this un-hinted arguments:</p>
<p>This is a constructor without default value and class hinted.</p>
<pre><code class="language-php">class AnotherClass
{
    public function _construct(ModelInterface $model, $config)
    {
        $bar = $config['foo']
    }
}

// Let's create this object with custom arguments:
$container-&gt;newInstance(AnotherClass::class, ['config' =&gt; ['foo' =&gt; 'bar']]);</code></pre>
<p>You can set multiple level arguments:</p>
<pre><code class="language-php">use Windwalker\Model\ModelInterface;

// ... AnotherClass

$config = [
    'config' =&gt; ['foo' =&gt; 'bar'],
    'Windwalker\Model\ModelInterface' =&gt; [
        'options' =&gt; $options,
        'db' =&gt; DatabaseFactory::getDbo()
    ]
];

$container-&gt;newInstance(AnotherClass::class, $config);</code></pre>
<h3>Prepare Object</h3>
<p>We can set a class as prepared, then it will be created when we really need it:</p>
<pre><code class="language-php">$container-&gt;prepareObject(MyClass::class);

// If we get MyClass, this class will be created.
$myObject = $container-&gt;get(MyClass::class);</code></pre>
<p>Add second argument if you want to configure something after object created:</p>
<pre><code class="language-php">$container-&gt;prepareObject(MyClass::class, function (MyClass $myClass, Container $container) {
    $myClass-&gt;debug = true;

    return $myClass;
});</code></pre>
<p>We can also prepare a shared object:</p>
<pre><code class="language-php">
// This object will be singleton
$container-&gt;prepareSharedObject(MyClass::class[, extending]);</code></pre>
<h3>Prepare Creating Arguments</h3>
<p>We can prepare some named arguments which will be injected to constructor when object creating.</p>
<pre><code class="language-php">// Set class meta
$container-&gt;whenCreating(MyModel::class)
    -&gt;setArgumemt('config', $config)
    -&gt;setArgument('db', $db);

// ...

$object = $container-&gt;newInstance(MyModel::class);</code></pre>
<p>Or just created it instantly:</p>
<pre><code class="language-php">$container-&gt;whenCreating(MyModel::class)
    -&gt;setArgumemt('config', $config)
    -&gt;setArgument('db', $db)
    -&gt;newInstance();</code></pre>
<h2>Binding Classes</h2>
<p>Sometimes when we are creating object, we may want to inject particular class which wer want, and different
from origin dependencies.</p>
<p>For example: Here is a class which dependent to <code>ModelInterface</code>, we can bind a subclass to container then container
will use <code>MyModel</code> class to be an instance of <code>ModelInterface</code> and inject it to <code>MyClass</code>.</p>
<pre><code class="language-php">use Windwalker\Model\ModelInterface;
use Windwalker\Data\Collection;

class MyClass
{
    public function __construct(public ModelInterface $model, public Collection $config)
    {

    }
}

class MyModel implements ModelInterface
{
}

// Bind MyModel as ModelInterface
$container-&gt;share(ModelInterface::class, fn () =&gt; new MyModel());

$myObject = $container-&gt;createObject(MyClass::class);

$myObject-&gt;model; // MyModel</code></pre>
<p>Use <code>bind()</code> to quickly bind a class without callback, container will use <code>newInstance()</code> to create it when needed.</p>
<pre><code class="language-php">$container-&gt;bind(ModelInterface::class, MyModel::class);

// `MyModel` will auto created because we bind it to `ModelInterface`
$container-&gt;createObject(MyClass::class);</code></pre>
<p>Use <code>bindShared()</code> to bind a class as singleton:</p>
<pre><code class="language-php">$container-&gt;bindShared(ModelInterface::class, MyModel::class);</code></pre>
<p>You can add callback as second argument, this way is totally same as <code>share()</code> and <code>set()</code>:</p>
<pre><code class="language-php">$container-&gt;bind(ModelInterface::class, fn () =&gt; new MyObject());</code></pre>
<h2>Extending</h2>
<p>Container allows you to extend an object, the new instance or closure will wrap the original one and you can do more
extending configuration, this is a sample:</p>
<pre><code class="language-php">// Create an object first
$container-&gt;share('flower', function() {
    // Create an empty object
    return new Flower();
});

$container-&gt;extend('flower', function(Flower $flower, Container $container) {
    // Set a property to this object
    $flower-&gt;name = 'sakura';

    return $flower;
});

$flower = $container-&gt;get('flower');

$flower-&gt;name; // sakura</code></pre>
<h2>Calling Function</h2>
<p>Container can execute any callable:</p>
<pre><code class="language-php">$result = $container-&gt;call($closure);

$result = $container-&gt;call([$object, 'method']);

$result = $container-&gt;call($invokalbeObject);</code></pre>
<p>You can also add arguments:</p>
<pre><code class="language-php">$closure = function (Sakura $sakura, int $numbers = 3) {

};

// Add argument with name
$result = $container-&gt;call($closure, [
    'sakura' =&gt; new Sakura(),
    'numbers' =&gt; 5
]);

// Add argument with class type, and ignore optional argument.
$result = $container-&gt;call($closure, [
    Sakura::class =&gt; new Sakura()
]);

// Use Autowire
$result = $container-&gt;call($closure, [], Container::AUTO_WIRE);</code></pre>                </article>

                                <div class="mt-6 border-top pt-4">
                    Found a typo? Something is wrong in this documentation?
                    <a class="btn btn-outline-secondary btn-sm"
                        href="https://github.com/windwalker-io/windwalker-io.github.io/tree/master/.vaseman/entries/documentation/components/di/basic-usage.md"
                        target="_blank">
                        <i class="far fa-pencil"></i>
                        Make an edit
                    </a>
                </div>
            </div>

            <div class="col-lg-2 l-documentation__toc">
                <div class="sticky-top" style="top: 65px">
                    <h5>Table of Contents</h5>

                    <div data-toc>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="copyright">
        <div class="">
            <hr class="mt-0" />

            <footer class="container d-flex flex-column flex-lg-row align-items-center justify-content-between">
                <div>
                    &copy; Windwalker 2022 - Made by
                    <a target="_blank" href="https://lyrasoft.net"
                        style="text-decoration: none"
                    >
                        LYRASOFT
                    </a>
                </div>

                <div>
                    <ul class="nav">
                        <li class="nav-item">
                            <a class="nav-link" href="https://windwalker-io.github.io/site-legacy"
                                target="_blank">
                                3.x Docs
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="https://github.com/windwalker-io"
                                target="_blank">
                                GitHub
                            </a>
                        </li>
                    </ul>
                </div>
            </footer>
        </div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://kit.fontawesome.com/cefe7e8fb3.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <script src="../../../assets/js/doc.js?453c762c52a43b2e08b09781"></script>
</body>
</html>
