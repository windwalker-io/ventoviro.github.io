<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <link rel="shortcut icon" href="../../../assets/images/logo-icon.png?1957a3d6d4ba2b9b6c049df8" />

    <title>Getting Started | Windwalker - PHP Rapid Development Framework</title>

    <meta property="og:image" content="https://i.imgur.com/1HHxwsI.jpg">

        
        <link href="https://unpkg.com/prism-themes@1.9.0/themes/prism-dracula.css" rel="stylesheet" />
    <link href="../../../assets/css/bootstrap.css?1957a3d6d4ba2b9b6c049df8" rel="stylesheet" />
        <link href="../../../assets/css/main.css?1957a3d6d4ba2b9b6c049df8" rel="stylesheet">

    </head>
<body class="view-home layout-documentation\components\attributes\write-handlers route-documentation\components\attributes\write-handlers" style="margin-top: 56px">

    <header class="l-main-header">
        <nav class="l-main-nav navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
            <div class="container">
                <a class="navbar-brand" href="../../../">
                    <img src="../../../assets/images/logo-cw-h.svg?1957a3d6d4ba2b9b6c049df8"
                        alt="LOGO"
                        style="height: 25px;"
                    />
                </a>
                <button class="navbar-toggler" type="button"
                    data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">

                    </ul>

                    <ul class="navbar-nav mb-2 mb-lg-0">
                                                                                                                                                                        <li class="nav-item">
                            <a class="nav-link active"
                                href="../../../documentation">
                                <i class="fa-solid fa-file-lines"></i>
                                Documentation
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active"
                                target="_blank"
                                href="https://github.com/windwalker-io/framework">
                                <i class="fa-brands fa-github"></i>
                                Github
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <div class="text-bg-success py-4" part="">
    <div class="container">
        <div class="gap-2">
            <div class="mb-1  fw-bold"
                style="margin-top: -0.5rem;">
                <a
                    class="link-light"
                    style="text-decoration: none; opacity: .85; "
                >
                    
                </a>
            </div>
            <h2 class="m-0 text-uppercase fw-bold">
                        Attributes

              
            </h2>
                             
            <div class="breadcrumb m-0">
    <a class="breadcrumb-item link-primary small"
        href="../../../documentation/"
        style="text-decoration: none">
        Documentation
    </a>

            <a class="breadcrumb-item link-primary small"
            href="../../../documentation/components.html"
            style="text-decoration: none">
            Components
        </a>
    </div>
         
                    </div>
    </div>
</div>

    <div class="l-documentation container my-5">
        <div class="row">
            <div class="l-documentation__menu col-lg-3">
                <h5 class="fw-bold">
                    Menu: Attributes
                </h5>

                <ul class="nav flex-column">
                                                                        <li class="nav-item">
    <a href="../../../documentation/components/attributes/index.html"
        class="nav-link ps-0 ">
        Introduction
    </a>
</li>
                                                                                                <li class="nav-item">
    <a href="../../../documentation/components/attributes/available-type-actions.html"
        class="nav-link ps-0 ">
        Available Types &amp; Actions
    </a>
</li>
                                                                                                <li class="nav-item">
    <a href="../../../documentation/components/attributes/write-handlers.html"
        class="nav-link ps-0 active text-success fw-bold">
        Writing Handlers
    </a>
</li>
                                                                                                <li class="nav-item">
    <a href="../../../documentation/components/attributes/misc.html"
        class="nav-link ps-0 ">
        Miscellaneous
    </a>
</li>
                                                            </ul>
            </div>

            <div class="col-lg-7 l-documentation__body">
                <article class="article-content" data-content
                    data-bs-spy="scroll"
                    data-bs-target="#toc"
                    data-bs-root-margin="0px 0px -100px"
                    data-bs-smooth-scroll="true"
                >
                    <h1>Write Your Own Attribute Handlers</h1>
<h2>Object &amp; Classes</h2>
<p>This is a Decorator example:</p>
<pre><code class="language-php">use Windwalker\Attributes\AttributeHandler;
use Windwalker\Attributes\AttributeInterface;
#[\Attribute(\Attribute::TARGET_CLASS | Attribute::IS_REPEATABLE)]
class Decorator implements AttributeInterface
{
    protected string $class;

    protected array $args = [];

    public function __construct(string $class, ...$args)
    {
        $this-&gt;class = $class;
        $this-&gt;args = $args;
    }
    public function __invoke(AttributeHandler $handler): callable
    {
        return fn (...$newInstanceArgs) =&gt; new ($this-&gt;class)($handler(...$newInstanceArgs), ...$this-&gt;args); 
    }
}</code></pre>
<p>There are 2 methods can decorate object or class.</p>
<ul>
<li><code>decorateObject(object $object): object</code></li>
<li><code>createObject(string $class, ...$args): object</code></li>
</ul>
<p>If you call <code>decorateObject($object)</code>, the <code>$handler(&lt;void&gt;)</code> will only return object which you sent into.</p>
<p>And if you call <code>createObject($class, ...$args)</code>, the <code>$handler(...$args)</code> will create object
by the class and pass <code>...$args</code> to constructor.</p>
<p>Then, use your own function wrap it, all handlers will be a callback stack and called after all attributes processed.</p>
<p>Example:</p>
<pre><code class="language-php">use Windwalker\Attributes\AttributesResolver;
use Windwalker\Attributes\AttributeType;

#[\Decorator(\Component::class, ['template' =&gt; 'foo.php'])]
class Foo 
{
    //
}

$attributes = new AttributesResolver();

// Work on Class and Object
$attributes-&gt;registerAttribute(\Decorator::class, AttributeType::CLASSES);

// Decorate existing object
$component = $attributes-&gt;decorateObject($object);

// Create object from class and decorate it.
$component = $attributes-&gt;createObject(\Foo::class, ...$args);</code></pre>
<h2>Use Custom Object Builder</h2>
<p>If you want to integrate with some Container packages, please set custom object builder.</p>
<pre><code class="language-php">$attributes-&gt;setBuilder(function (string $class, ...$args) use ($container) {
    return $container-&gt;createObject($class, ...$args);
});</code></pre>
<blockquote>
<p>TODO: Support custom call() handler.</p>
</blockquote>
<h2>Functions &amp; Methods</h2>
<p>Functions &amp; Methods type will not return anything, use this type to determine attributes exists and do something else.
This is an example to register methods to another object.</p>
<pre><code class="language-php">use Windwalker\Attributes\AttributeHandler;
use Windwalker\Attributes\AttributeInterface;
#[\Attribute(\Attribute::TARGET_METHOD | \Attribute::IS_REPEATABLE)]
class ListenTo implements AttributeInterface
{
    public function __construct(protected string $event) 
    {
        //
    }
    public function __invoke(AttributeHandler $handler): callable
    {
        return function () use ($handler) {
            $provider = $handler-&gt;getResolver()-&gt;getOption('provider');
            $listener = $handler();
            $provider-&gt;addListener(
                $this-&gt;event,
                $listener
            );
            return $listener;
        };
    }
}</code></pre>
<p>The <code>$handler()</code> will just return method callable array <code>[$object, 'method_name'']</code> or function name.</p>
<pre><code class="language-php">use Windwalker\Attributes\AttributesResolver;
use Windwalker\Attributes\AttributeType;
class Subscriber 
{
    #[\ListenTo(\FooEvent::class)]
    public function foo()
    {
        //
    }
}
$attributes = new AttributesResolver();
$attributes-&gt;registerAttribute(\ListenTo::class, AttributeType::METHODS | AttributeType::FUNCTIONS);
$attributes-&gt;resolveMethods(new \Subscriber());</code></pre>
<h2>Callable</h2>
<p>An example to control HTTP allow methods and Json Response.</p>
<pre><code class="language-php">use Windwalker\Attributes\AttributeHandler;
use Windwalker\Attributes\AttributeInterface;
#[\Attribute(\Attribute::TARGET_METHOD | \Attribute::TARGET_FUNCTION)]
class Method implements AttributeInterface
{
    protected array $allows = [];

    public function __construct(string|array $allows = [])
    {
        $this-&gt;allows = array_map('strtoupper', (array) $allows);
    }
    public function __invoke(AttributeHandler $handler): callable
    {
        return function ($request, $reqHandler) use ($handler) {
            if (!in_array($request-&gt;getMethod(), $this-&gt;allows, true)) {
                throw new \RuntimeException('Invalid Method', 405);
            }
            // You can change parameters here.

            $res = $handler($request, $reqHandler);
            // You can also modify return value.
            return $res;
        }; 
    }
}</code></pre>
<pre><code class="language-php">use Windwalker\Attributes\AttributeHandler;
use Windwalker\Attributes\AttributeInterface;
#[\Attribute(\Attribute::TARGET_METHOD | \Attribute::TARGET_FUNCTION)]
class Json implements AttributeInterface
{
    public function __invoke(AttributeHandler $handler): callable
    {
        return function ($request, $reqHandler) use ($handler) {
            $res = $handler($request, $reqHandler);
            $res = $res-&gt;withHeader('Content-Type', 'application/json');
            return $res;
        }; 
    }
}</code></pre>
<p>The <code>$handler(...$args)</code> in callable attributes is to call the target callable, we can change/validate parameters
or modify the return value.</p>
<p>Usage:</p>
<pre><code class="language-php">use Windwalker\Attributes\AttributesResolver;
use Windwalker\Attributes\AttributeType;
class Controller 
{
    #[\Method('GET')]
    #[\Json]
    public function index():Response
    {
        return new Response();
    }
}
$attributes = new AttributesResolver();
$attributes-&gt;registerAttribute(\Method::class, AttributeType::CALLABLE);
$attributes-&gt;registerAttribute(\Json::class, AttributeType::CALLABLE);
// Call
$jsonResponse = $attributes-&gt;call(
    [new \Controller(), 'index'], // Callable 
    [$request, 'handler' =&gt; $resHandler], // Args should be array, support php8 named arguments
    [?object $context = null] // Context is an object wll bind as this for the callable, default is NULL. 
);</code></pre>
<h2>Parameters</h2>
<p>An example to handler parameters to upper case</p>
<pre><code class="language-php">use Windwalker\Attributes\AttributeHandler;
use Windwalker\Attributes\AttributeInterface;
#[\Attribute(\Attribute::TARGET_PARAMETER)]
class Upper implements AttributeInterface
{
    public function __invoke(AttributeHandler $handler): callable
    {
        return fn () =&gt; strtoupper((string) $handler());
    }
}</code></pre>
<p>The <code>$handler()</code> in parameter attributes is to simply get parameter values, you can modify this value and return it.</p>
<pre><code class="language-php">use Windwalker\Attributes\AttributesResolver;
use Windwalker\Attributes\AttributeType;
class Http 
{
    public static function request(
        #[\Upper]
        string $method,
        mixed $data = null,
        array $options = []
    ) {
        // $method should always upper case.
    }
}
$attributes = new AttributesResolver();
$attributes-&gt;registerAttribute(\Upper::class, \Attribute::TARGET_PARAMETER);
// Decorate existing object
$jsonResponse = $attributes-&gt;call([\Http::class, 'request'], ['POST', 'foo=bar']);</code></pre>
<h2>Properties</h2>
<p>This is an example to handle all properties of an object.</p>
<pre><code class="language-php">use Windwalker\Attributes\AttributeHandler;
use Windwalker\Attributes\AttributeInterface;
#[\Attribute(\Attribute::TARGET_PROPERTY)]
class Wrapper implements AttributeInterface
{
    public function __invoke(AttributeHandler $handler): callable
    {
        /** @var $ref ReflectionProperty */
        $ref = $handler-&gt;getReflector();
        // Since php8 supports union type, we should get first exists class type as possible type.
        $type = ReflectionHelper::getFirstExistsClassType($ref);
        $class = $type-&gt;getName();
        return fn () =&gt; new $class($handler());
    }
}</code></pre>
<p>The <code>$handler()</code> in properties attributes is to simply get property values, you can modify this value and return it.
No matter these properties are public or protected, AttributesResolver will force set value into it.</p>
<p>Usage:</p>
<pre><code class="language-php">use Windwalker\Attributes\AttributesResolver;
use Windwalker\Attributes\AttributeType;
$object = new class {
    #[\Wrapper]
    protected ?Collection $options = null;
};
$attributes = new AttributesResolver();
$attributes-&gt;registerAttribute(\Wrapper::class, \Attribute::TARGET_PROPERTY);
$object = $attributes-&gt;resolveProperties($object);</code></pre>                </article>
            </div>

            <div class="col-lg-2 l-documentation__toc">
                <div class="sticky-top" style="top: 65px">
                    <h5>Table of Contents</h5>

                    <div data-toc>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="copyright">
        <div class="">
            <hr class="mt-0" />

            <footer class="container d-flex align-items-center justify-content-between">
                <div>
                    &copy; Windwalker 2022 - Made by
                    <a target="_blank" href="https://lyrasoft.net"
                        style="text-decoration: none"
                    >
                        LYRASOFT
                    </a>
                </div>

                <div>
                    <ul class="nav">
                        <li class="nav-item">
                            <a class="nav-link" href="https://windwalker-io.github.io/site-legacy"
                                target="_blank">
                                3.x Docs
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="https://github.com/windwalker-io"
                                target="_blank">
                                GitHub
                            </a>
                        </li>
                    </ul>
                </div>
            </footer>
        </div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://kit.fontawesome.com/cefe7e8fb3.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <script src="../../../assets/js/doc.js?1957a3d6d4ba2b9b6c049df8"></script>
</body>
</html>
